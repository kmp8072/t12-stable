define(["jquery","core/notification","core/templates","core/ajax","core/dialogue"],function(a,b,c,d,e){var f=null,g=0,h=0,i=function(){h=a("#id_scaleid").val();var d=a("#id_scaleid option:selected").text();m(h).done(function(){var a={scalename:d,scales:f};c.render("tool_lp/scale_configuration_page",a).done(function(a){new e(d,a,k)}).fail(b.exception)}).fail(b.exception)},j=function(){var b=a("#tool_lp_scaleconfiguration").val();if(""!==b){var c=a.parseJSON(b),d=c.shift();if(d.scaleid===g)return c}return""},k=function(b){var c=a(b.getContent());if(g===h){var d=j();""!==d&&d.forEach(function(b){1===b.scaledefault&&a("#tool_lp_scale_default_"+b.id).attr("checked",!0),1===b.proficient&&a("#tool_lp_scale_proficient_"+b.id).attr("checked",!0)})}c.on("click",'[data-action="close"]',function(){l(),b.close()}),c.on("click",'[data-action="cancel"]',function(){b.close()})},l=function(){var b=[{scaleid:h}];f.forEach(function(c){var d=0,e=0;a("#tool_lp_scale_default_"+c.id).is(":checked")&&(d=1),a("#tool_lp_scale_proficient_"+c.id).is(":checked")&&(e=1),b.push({name:c.name,id:c.id,scaledefault:d,proficient:e})});var c=JSON.stringify(b);a("#tool_lp_scaleconfiguration").val(c),g=h},m=function(b){var c=a.Deferred(),e=d.call([{methodname:"tool_lp_get_scale_values",args:{scaleid:b}}]);return e[0].done(function(a){f=a,c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()};return{init:function(){g=a("#id_scaleid").val(),a("#id_scaleconfigbutton").click(i)}}});