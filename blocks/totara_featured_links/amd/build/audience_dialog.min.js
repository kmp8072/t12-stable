define(["jquery","core/ajax","block_totara_featured_links/visibility_form","core/str","core/config","core/templates"],function(a,b,c,d,e,f){var g,h="",i={},j={ok:"",cancel:"",title:""},k=function(){var b=function(){this.baseurl=""};b.prototype=new totaraDialog_handler_treeview_multiselect,b.prototype.every_load=function(){a("#audience_visible_table").find("[cohortid]").each(function(){var b=a(this).attr("cohortid");d._toggle_items("item_"+b,!1)}),this._make_selectable(a(".treeview",this._container)),this._make_deletable(a(".selected",this._container))},h=i.instanceid;var d=new b;g=d;var k={};k[j.ok]=function(){d._update()},k[j.cancel]=function(){d._cancel()};var l=e.wwwroot+"/totara/cohort/dialog/";new totaraDialog("course-cohorts-visible-dialogue","add_audience_id",{buttons:k,title:j.title},l+"cohort.php?selected="+i.visibleselected+"&instancetype="+i.instancetype+"&instanceid="+i.instanceid+"&sesskey="+i.sesskey,d),b.prototype._update=function(){var b=a(".selected [id^=item]",this._container);b.each(function(){var b=a(this).attr("id").split("_");if(b=b[b.length-1],b=parseInt(b),!c.audience_list_contains(b)){var d={cohortid:b,name:a(this).find("a").text()},e=f.render("block_totara_featured_links/element_audience_list_item",d);e.done(function(a){c.add_to_audience_list(a),c.add_to_audience_id(b),c.add_audience_table_listeners()})}}),d._dialog.hide()}};return{init:function(b,c,e){i.instancetype=b,i.instanceid=c,i.sesskey=e;var f=[];f.push({key:"ok",component:"moodle"}),f.push({key:"cancel",component:"moodle"}),f.push({key:"audience_add",component:"block_totara_featured_links"}),d.get_strings(f).done(function(b){j={ok:b[0],cancel:b[1],title:b[2]},window.dialogsInited?k():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(k))})}}});