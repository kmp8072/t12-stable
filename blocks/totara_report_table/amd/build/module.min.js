define(["jquery","core/config"],function(a,b){var c={change_links:function(d,e){var f=null;a(".block_totara_report_table."+d+" .content .rb-display-table-container").find("div.paging a, th.header a").each(function(){a(this).click(function(g){g.preventDefault();var h=a(this),i=h.attr("href"),j=i.slice(i.indexOf("?")+1);if(j+="&sesskey="+b.sesskey+"&blockid="+e,f&&f.abort(),0===a(g.target).siblings(".instantreportwait").length){var k='<div class="instantreportwait"><img src="'+M.util.image_url("waitbig","totara_reportbuilder")+'"/></div>',l=a(k).insertBefore(a(g.target).parent().children().last()),m=a(".block_totara_report_table."+d+" .content .rb-display-table-container"),n=m.offset();l.css(n),l.height(m.height()),l.width(m.width())}f=c.refresh_results(d,j,function(){c.change_links(d,e)})})})},refresh_results:function(c,d,e){return a.get(b.wwwroot+"/blocks/totara_report_table/ajax_instantreport.php?"+d).done(function(b){var d=a(".block_totara_report_table."+c+" .content");d.find(".instantreportwait").remove(),d.find(".rb-display-table-container").remove(),d.prepend(a(b).find(".rb-display-table-container")),d.find("form").remove(),e&&e()})},populatelist:function(){var c=a("#id_config_savedsearch");a("#id_config_reportid").change(function(){var d=a(this).val();""!==d&&(c.attr("disabled","disabled"),a.ajax({type:"POST",url:b.wwwroot+"/blocks/totara_report_table/ajax_list_saved.php",data:{reportid:d,sesskey:M.cfg.sesskey},success:function(a){c.find("option").remove(),c.append('<option value="">'+M.util.get_string("allavailabledata","block_totara_report_table")+"</option>");for(var b in a)c.append('<option value="'+b+'">'+a[b]+"</option>");c.removeAttr("disabled")}}))})}};return c});