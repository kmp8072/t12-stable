define(["jquery","totara_form/form","core/str"],function(a,b,c){function d(a,c,e){return this instanceof d?(b.Group.call(this,a,c,e),this.fieldset=null,this.legend=null,this.input=null,void(this.link=null)):new d(a,c,e)}return d.prototype=Object.create(b.Group.prototype),d.prototype.constructor=d,d.prototype.toString=function(){return"[object SectionGroup]"},d.prototype.init=function(b){return this.fieldset=a("#"+this.id),this.legend=a("#"+this.id+" legend.tf_section_legend"),this.input=a("#"+this.id+" input.tf_section_collapsible"),this.fieldset.hasClass("collapsed")||this.fieldset.hasClass("collapsible")?(this.fieldset.hasClass("collapsed")?this.legend.html('<a href="#" role="button" aria-expanded="false">'+this.legend.html()+"</a>"):this.legend.html('<a href="#" role="button" aria-expanded="true">'+this.legend.html()+"</a>"),this.link=a("#"+this.id+" legend.tf_section_legend a"),this.link.click(a.proxy(this.toggleCollapsed,this)),d.instances.push(this),d.instancecount++,2===d.instancecount&&d.addExpandAll(this.getForm()),void b()):void b()},d.prototype.toggleCollapsed=function(a){a.preventDefault(),this.fieldset.hasClass("collapsed")?this.expand():this.collapse()},d.prototype.expand=function(){b.debug("Expanding section "+this.legend.text(),this,b.LOGLEVEL.debug),this.fieldset.removeClass("collapsed"),this.fieldset.addClass("collapsible"),this.link.attr("aria-expanded","true"),this.input.val(1)},d.prototype.collapse=function(){b.debug("Collapsing section "+this.legend.text(),this,b.LOGLEVEL.debug),this.fieldset.addClass("collapsed"),this.fieldset.removeClass("collapsible"),this.link.attr("aria-expanded","false"),this.input.val(0)},d.getValue=function(){return null},d.instancecount=0,d.instances=[],d.expandallcontrol=null,d.addExpandAll=function(e){b.debug("Adding expand/collapse all for sections",this,b.LOGLEVEL.info);var f='<div class="collapsible-actions form-section-expandall-control">';f+='<a href="#" class="collapseexpand" role="button" aria-controls="">&nbsp;-&nbsp;</a>',f+="</div>",e.form.prepend(f),d.expandallcontrol=a(".form-section-expandall-control"),c.get_string("expandall").done(function(a){d.expandallcontrol.find("a").html(a)}),d.expandallcontrol.click(a.proxy(this.toggleAll,this)),d.expandallcontrol.data("state","expand")},d.toggleAll=function(a){a.preventDefault();var b,e,f=d.expandallcontrol,g=f.data("state"),h=f.find("a"),i="expand"===g;for(b=0;b<d.instances.length;b++)e=d.instances[b],i?e.expand():e.collapse();i?(f.data("state","collapse"),h.addClass("collapse-all"),c.get_string("collapseall","core").done(function(a){h.html(a)})):(f.data("state","expand"),h.removeClass("collapse-all"),c.get_string("expandall","core").done(function(a){h.html(a)}))},d});