define(["jquery"],function(a){var b=function(b){this.addressinfo={},this.formprefix="";var c=this;this.formprefix=""!==b.formprefix&&"undefined"!=typeof b.formprefix?b.formprefix:"",this.geocode_address=function(){var b=this.url_encode_address(this.addressinfo.address);""!==b&&a.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+b+"&region="+this.addressinfo.locationdefaults.regionbias,type:"GET",success:function(a,b){"success"==b&&a.results.length>0&&(c.addressinfo.address=a.results[0].formatted_address,c.addressinfo.latlng=a.results[0].geometry.location,c.load_map())},error:function(a,b){}})},this.url_encode_address=function(a){return a.replace(/\s+/g,"+")},this.load_map=function(b){if(b="undefined"!=typeof b?b:!0,"undefined"!=this.addressinfo.latlng){var d={center:{lat:this.addressinfo.latlng.lat,lng:this.addressinfo.latlng.lng},zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!0,rotateControl:!1,mapTypeId:this.addressinfo.view,zoom:this.get_zoom_level()};if(this.addressinfo.map=new google.maps.Map(document.getElementById(this.formprefix+"location_map"),d),b||this.set_map_view(),this.addressinfo.marker=new google.maps.Marker({position:{lat:this.addressinfo.latlng.lat,lng:this.addressinfo.latlng.lng},map:this.addressinfo.map,draggable:!b}),a("#"+this.formprefix+"latitude").val(this.addressinfo.latlng.lat),a("#"+this.formprefix+"longitude").val(this.addressinfo.latlng.lng),b){var e="";if(!("undefined"!==this.addressinfo.address&&this.addressinfo.address.length>0))return;e=this.addressinfo.address;var f=new google.maps.InfoWindow({content:e});this.addressinfo.marker.addListener("click",function(){f.open(c.addressinfo.map,c.addressinfo.marker)})}else this.addressinfo.marker.addListener("drag",function(b){a("#"+c.formprefix+"latitude").val(b.latLng.lat()),a("#"+c.formprefix+"longitude").val(b.latLng.lng())})}},this.set_map_view=function(){var b=a(".radio_view:checked");b.each(function(a,b){if(b.id.indexOf(c.formprefix)>-1)switch(b.value){case"hybrid":c.addressinfo.map.setMapTypeId(window.google.maps.MapTypeId.HYBRID),c.addressinfo.view=window.google.maps.MapTypeId.HYBRID;break;case"satellite":c.addressinfo.map.setMapTypeId(window.google.maps.MapTypeId.SATELLITE),c.addressinfo.view=window.google.maps.MapTypeId.SATELLITE;break;default:c.addressinfo.map.setMapTypeId(window.google.maps.MapTypeId.ROADMAP),c.addressinfo.view=window.google.maps.MapTypeId.ROADMAP}})},this.get_zoom_level=function(){return"undefined"!=typeof this.addressinfo.locationdefaults?parseInt(this.addressinfo.locationdefaults.defaultzoomlevel):12},a("#id_"+this.formprefix+"searchaddress_btn").on("click",function(b){b.preventDefault(),c.addressinfo.address=a("#id_"+c.formprefix+"addresslookup").val().trim(),c.geocode_address()}),a("#id_"+this.formprefix+"useaddress_btn").on("click",function(b){b.preventDefault(),c.addressinfo.address=a("#id_"+c.formprefix+"address").val().trim(),c.geocode_address()}),a(".radio_view").on("change",function(a){this.id.indexOf(c.formprefix)>-1&&(c.set_map_view(),c.load_map(!0))});var d=a("#"+this.formprefix+"location_map");if(d.length){var e=b.fordisplay;if(this.addressinfo.locationdefaults=b,this.addressinfo.latlng={},!a("#"+this.formprefix+"latitude").length)return void d.hide();if(this.addressinfo.latlng.lat=parseFloat(a("#"+this.formprefix+"latitude").val()),!a("#"+this.formprefix+"longitude").length)return void d.hide();this.addressinfo.latlng.lng=parseFloat(a("#"+this.formprefix+"longitude").val()),a("#"+this.formprefix+"address").length?this.addressinfo.address=a("#"+this.formprefix+"address").val().trim():this.addressinfo.address="",a("#"+this.formprefix+"room-location-view").length?"map"==a("#"+this.formprefix+"room-location-view").val()?this.addressinfo.view=google.maps.MapTypeId.ROADMAP:"satellite"==a("#"+location.formprefix+"room-location-view").val()?this.addressinfo.view=google.maps.MapTypeId.SATELLITE:this.addressinfo.view=google.maps.MapTypeId.HYBRID:this.addressinfo.view=google.maps.MapTypeId.ROADMAP,this.load_map(e)}};return{init:function(a){return new b(a)}}});