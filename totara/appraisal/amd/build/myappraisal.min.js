define(["jquery","core/str","core/config"],function(a,b,c){var d={config:{},init:function(e){e&&(d.config=a.parseJSON(e));var f=a("input#id_submitbutton").closest("form"),g=a("<input>").attr({type:"hidden",name:"submitaction"}).val("saveprogress"),h=a("<input>").attr({type:"hidden",name:"submitaction"}).val("completestage");a("#saveprogress").on("submit",function(a){window.onbeforeunload=null,a.preventDefault(),f.append(g),f.submit()}),a("#completestage").on("submit",function(a){window.onbeforeunload=null,a.preventDefault(),f.append(h),f.submit()});var i=[];i.push({key:"printyourappraisal",component:"totara_appraisal"}),i.push({key:"snapshotdialogtitle",component:"totara_appraisal"}),b.get_strings(i).done(function(b){for(var e=[],f=0;f<i.length;f++)e[i[f].key]=b[f];var g=c.wwwroot+"/totara/appraisal/snapshot.php",h={appraisalid:d.config.appraisalid,role:d.config.role,subjectid:d.config.subjectid,action:"stages"},j=a.param(h);d.stagesSelectDialog("print",e.printyourappraisal,g+"?"+j,g);var k={appraisalid:d.config.appraisalid,role:d.config.role,subjectid:d.config.subjectid,action:"snapshot",sesskey:c.sesskey},l=a.param(k);d.savePdfDialog("savepdf",e.snapshotdialogtitle,g+"?"+l)}),setInterval(d.keepAlive,1e3*d.config.keepalivetime)},stagesSelectDialog:function(c,d,e,f){var g=new totaraDialog_handler;g._print=function(b,c){var d=a("#printform").serialize();M.util.help_popups.setup(Y);var e={name:"printpopup",url:c+"?"+d,options:"height=500,width=600,top=100,left=100,menubar=0,location=0,scrollbars,resizable,toolbar,status,directories=0,dependent"};openpopup(b,e),g._cancel()};var h=[];h.push({key:"printnow",component:"totara_appraisal"}),h.push({key:"cancel",component:"moodle"}),b.get_strings(h).done(function(a){for(var b=[],i=0;i<h.length;i++)b[h[i].key]=a[i];var j={};j[b.printnow]=function(a){g._print(a,f)},j[b.cancel]=function(){g._cancel()},totaraDialogs[c]=new totaraDialog(c,"show-"+c+"-dialog",{buttons:j,title:"<h2>"+d+"</h2>"},e,g)})},savePdfDialog:function(c,d,e){var f=new totaraDialog_handler;f._download=function(){var b=a("#downloadurl").val();b&&(window.location.href=b,f._cancel())},f._open=function(){f._dialog.dialog.html(b.get_string("snapshotgeneration","totara_appraisal"))};var g=[];g.push({key:"downloadnow",component:"totara_appraisal"}),g.push({key:"cancel",component:"moodle"}),b.get_strings(g).done(function(a){for(var b=[],h=0;h<g.length;h++)b[g[h].key]=a[h];var i={};i[b.downloadnow]=function(){f._download()},i[b.cancel]=function(){f._cancel()},totaraDialogs[c]=new totaraDialog(c,"show-"+c+"-dialog",{buttons:i,title:"<h2>"+d+"</h2>",height:"200"},e,f)})},keepAlive:function(){a.get(c.wwwroot+"/totara/appraisal/keepalive.php")}};return d});