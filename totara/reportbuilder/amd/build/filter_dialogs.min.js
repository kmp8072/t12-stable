define(["jquery","core/config","core/str"],function(a,b,c){var d={waitingitems:[],reportid:0,init:function(b,c,e,f,g){d.waitingitems.push({filter:b,value:c,hierarchytype:e,name:f}),d.reportid=g,window.dialogsInited?this.rb_init_filter_dialogs():(a.isArray(window.dialoginits)||(window.dialoginits=[]),1===this.waitingitems.length&&window.dialoginits.push(this.rb_init_filter_dialogs))},rb_init_filter_dialogs:function(){var b=a.extend(!0,[],d.waitingitems);d.waitingitems=[],a.each(b,function(){switch(this.filter){case"hierarchy":d.rb_load_hierarchy_filters(this);break;case"badge":d.rb_load_badge_filters(this);break;case"jobassign_multi":d.rb_load_jobassign_multi_filters();case"hierarchy_multi":d.rb_load_hierarchy_multi_filters();break;case"cohort":d.rb_load_cohort_filters();break;case"category":d.rb_load_category_filters();break;case"course_multi":d.rb_load_course_multi_filters()}}),a(document).on("click",".multiselect-selected-item a",function(b){b.preventDefault();var c=a(this).parents("div.multiselect-selected-item"),d=c.data("filtername"),e=c.data("id"),f=a("input[name="+d+"]"),g=f.val(),h=g.split(","),i=a.grep(h,function(a){return a!=e}),j=i.join(",");f.val(j),c.remove()})},rb_load_hierarchy_filters:function(d){if(d.name)var e="input#show-"+d.name+"-dialog";else var e="input";switch(d.hierarchytype){case"org":a(e+".rb-filter-choose-org").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/hierarchy/prefix/organisation/assign/";c.get_string("chooseorganisation","totara_hierarchy").done(function(a){totaraSingleSelectDialog(e,a+d.value,f+"find.php?",e,e+"title")}),"0"===a("select[name="+e+"_op]").val()&&(a("input[name="+e+"_rec]").prop("disabled",!0),a("#show-"+e+"-dialog").prop("disabled",!0))});break;case"pos":a(e+".rb-filter-choose-pos").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/hierarchy/prefix/position/assign/";c.get_string("chooseposition","totara_hierarchy").done(function(a){totaraSingleSelectDialog(e,a+d.value,f+"position.php?",e,e+"title")}),"0"===a("select[name="+e+"_op]").val()&&(a("input[name="+e+"_rec]").prop("disabled",!0),a("#show-"+e+"-dialog").prop("disabled",!0))});break;case"comp":a(e+".rb-filter-choose-comp").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/hierarchy/prefix/competency/assign/";c.get_string("selectcompetency","totara_hierarchy").done(function(a){totaraSingleSelectDialog(e,a+d.value,f+"find.php?",e,e+"title")}),"0"===a("select[name="+e+"_op]").val()&&(a("input[name="+e+"_rec]").prop("disabled",!0),a("#show-"+e+"-dialog").prop("disabled",!0))})}},rb_load_jobassign_multi_filters:function(){var d=this;a("div.rb-man-add-link a").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/job/assignfilter/manager/";c.get_string("choosemanplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(e,a,f+"find.php?reportid="+d.reportid,f+"save.php?reportid="+d.reportid+"&filtername="+e+"&ids=")})}),a("div.rb-app-add-link a").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/job/assignfilter/appraiser/";c.get_string("chooseappplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(e,a,f+"find.php?reportid="+d.reportid,f+"save.php?reportid="+d.reportid+"&filtername="+e+"&ids=")})})},rb_load_hierarchy_multi_filters:function(){a("div.rb-org-add-link a").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/hierarchy/prefix/organisation/assignfilter/";c.get_string("chooseorgplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?",e+"save.php?filtername="+d+"&ids=")})}),a("div.rb-pos-add-link a").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/hierarchy/prefix/position/assignfilter/";c.get_string("chooseposplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?",e+"save.php?filtername="+d+"&ids=")})}),a("div.rb-comp-add-link a").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/hierarchy/prefix/competency/assignfilter/";c.get_string("choosecompplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?",e+"save.php?filtername="+d+"&ids=")})})},rb_load_cohort_filters:function(){a("div.rb-cohort-add-link a").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/reportbuilder/ajax/";c.get_string("choosecohorts","totara_cohort").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find_cohort.php?sesskey="+b.sesskey,e+"save_cohort.php?sesskey="+b.sesskey+"&filtername="+d+"&ids=")})})},rb_load_badge_filters:function(d){a("div.rb-badge-add-link a").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/totara/reportbuilder/ajax/";c.get_string("choosebadges","badges").done(function(a){totaraMultiSelectDialogRbFilter(e,a,f+"find_badge.php?reportid="+d.value+"&sesskey="+b.sesskey,f+"save_badge.php?filtername="+e+"&sesskey="+b.sesskey+"&ids=")})})},rb_load_category_filters:function(){a(document).on("change","#id_course_category-path_op",function(b){b.preventDefault();var c=a(this).attr("name");c=c.substr(0,c.length-3),"0"===a(this).val()?(a("input[name="+c+"_rec]").prop("disabled",!0),a("#show-"+c+"-dialog").prop("disabled",!0)):(a("input[name="+c+"_rec]").prop("disabled",!1),a("#show-"+c+"-dialog").prop("disabled",!1))}),a("input.rb-filter-choose-category").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/reportbuilder/ajax/filter/category/";c.get_string("choosecatplural","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?sesskey="+b.sesskey,e+"save.php?filtername="+d+"&sesskey="+b.sesskey+"&ids=")}),"0"===a("select[name="+d+"_op]").val()&&(a("input[name="+d+"_rec]").prop("disabled",!0),a("#show-"+d+"-dialog").prop("disabled",!0))})},rb_load_course_multi_filters:function(){a(document).on("change","#id_course-id_op",function(b){b.preventDefault();var c=a(this).attr("name");c=c.substr(0,c.length-3),"0"===a(this).val()?(a("input[name="+c+"_rec]").prop("disabled",!0),a("#show-"+c+"-dialog").prop("disabled",!0)):(a("input[name="+c+"_rec]").prop("disabled",!1),a("#show-"+c+"-dialog").prop("disabled",!1))}),a("input.rb-filter-choose-course").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/totara/reportbuilder/ajax/filter/course_multi/";c.get_string("coursemultiitemchoose","totara_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?sesskey="+b.sesskey,e+"save.php?filtername="+d+"&sesskey="+b.sesskey+"&ids=")}),"0"===a("select[name="+d+"_op]").val()&&(a("input[name="+d+"_rec]").prop("disabled",!0),a("#show-"+d+"-dialog").prop("disabled",!0))})}};return d});