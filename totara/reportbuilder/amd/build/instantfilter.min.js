define(["jquery","core/config"],function(a,b){var c={xhr:null,init:function(){a(".rb-sidebar input:not(.ignoredirty), .rb-sidebar select").change(function(b){if(c.xhr&&c.xhr.abort(),0===a(b.target).siblings(".instantfilterwait").length){var d='<img src="'+M.util.image_url("wait","totara_reportbuilder")+'" class="iconsmall instantfilterwait" />';a(d).insertAfter(a(b.target).parent().children().last())}c.xhr=c.refresh_results()})},split_search:function(a){var b={};if(void 0===a||a.length<1)return b;for(var c=a.slice(1).split("&"),d=0;d<c.length;d++){var e=c[d].split("="),f=decodeURIComponent(e[0]).replace(/\+/g," "),g=decodeURIComponent(e[1]).replace(/\+/g," ");void 0===b[f]&&(b[f]=[]),b[f].push(g)}return b},remove_param:function(a,b){return a[b]&&delete a[b],a},build_search:function(a){var b="?";for(var c in a)for(var d=0;d<a[c].length;d++)b+="?"==b?"":"&",b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]);return b},refresh_results:function(d){var e=window.location.search,f=c.split_search(e);return f=c.remove_param(f,"spage"),f=c.remove_param(f,"ssort"),f=c.remove_param(f,"sid"),f=c.remove_param(f,"clearfilters"),e=c.build_search(f),a.post(b.wwwroot+"/totara/reportbuilder/ajax/instantreport.php"+e,a(".rb-sidebar").serialize()).done(function(b){a(".instantfilterwait").remove(),a(".rb-display-table-container").replaceWith(a(b).find(".rb-display-table-container")),a(".rb-record-count").replaceWith(a(b).find(".rb-record-count")),a(b).find(".rb-sidebar.mform label").each(function(b,c){var d=a(c);d.attr("for")&&a('label[for="'+d.attr("for")+'"]').html(d.html())}),d&&d()})}};return c});