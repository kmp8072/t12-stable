define([],function(){function a(){return this instanceof a?(this.activeClass="tw-selectMulti__link_active",this.activeSelector="data-tw-selector-active",this.clearSelector="data-tw-selectorgroup-clear",this.hideClass="tw-selectMulti__hidden",void(this.widget="")):new a}a.prototype={constructor:a,add:function(a){var b=a.getAttribute("data-tw-selectMulti-urlkey"),c=a.querySelector("[data-tw-selectMulti-close]");a.classList.add(this.activeClass),a.setAttribute(this.activeSelector,!0),a.setAttribute("aria-selected",!0),c.classList.remove(this.hideClass),this.triggerEvent("add",{key:b,val:1})},clear:function(){for(var a=this.widget.querySelectorAll("["+this.activeSelector+"]"),b=0;b<a.length;b++)this.remove(a[b])},events:function(){var a=this;this.widget.addEventListener("click",function(b){if(b.preventDefault(),b.target&&b.target.closest("[data-tw-selectMulti-urlkey]")){var c=b.target.closest("[data-tw-selectMulti-urlkey]");c.getAttribute(a.activeSelector)?a.remove(c):a.add(c),a.triggerEvent("changed",{})}});var b=new MutationObserver(function(){"true"===a.widget.getAttribute(a.clearSelector)&&(a.clear(),a.widget.setAttribute(a.clearSelector,!1))});b.observe(this.widget,{attributes:!0,attributeFilter:[a.clearSelector],subtree:!1})},preset:function(){for(var a=this.widget.querySelectorAll("["+this.activeSelector+"]"),b=0;b<a.length;b++)this.triggerEvent("add",{key:a[b].getAttribute("data-tw-selectMulti-urlkey"),val:1})},remove:function(a){var b=a.getAttribute("data-tw-selectMulti-urlkey"),c=a.querySelector("[data-tw-selectMulti-close]");a.removeAttribute(this.activeSelector),a.setAttribute("aria-selected",!1),a.classList.remove(this.activeClass),c.classList.add(this.hideClass),this.triggerEvent("remove",{key:b,val:0})},setParent:function(a){this.widget=a},triggerEvent:function(a,b){var c=new CustomEvent("totara_core/select_multi:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var b=function(b){return new Promise(function(c){var d=new a;d.setParent(b),d.preset(),d.events(),c(d)})};return{init:b}});