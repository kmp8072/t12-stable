define(["jquery","core/config","core/localstorage","core/ajax"],function(a,b,c,d){var e=!1,f=!1,g=[],h=function(){var a="core_flex_icon/"+b.theme+"/cache";e=!0;var h=c.get(a);if(h)f=JSON.parse(h);else{var i=d.call([{methodname:"core_output_get_flex_icons",args:{themename:b.theme}}],!0,!1);i[0].done(function(b){c.set(a,JSON.stringify(b)),f=b;for(var d=0;d<g.length;d++)g[d].resolve()})}},i={loadingflex:[],loadingtranslation:[],getFlexTemplateData:function(c){var d=a.Deferred();if(this.loadingflex.length>0){for(var e in this.loadingflex)if(this.loadingflex[e].theme===b.theme&&this.loadingflex[e].identifier===c)return this.loadingflex[e].promise}else this.loadingflex.push({theme:b.theme,identifier:c,promise:d.promise()});var h=function(){if("undefined"==typeof f.icons[c])return void d.reject();var a=f.icons[c],b={data:f.datas[a[1]],template:f.templates[a[0]]};d.resolve(b)};if(f)h();else{var i=a.Deferred();i.done(function(){h()}),g.push(i)}return d.promise()}};return e||h(),i});